function(CHECK_COMPILER_FLAG_SUPPORT FLAG SUPPORT_VAR FLAGS_VAR)
    include(CheckCXXCompilerFlag)
    CHECK_CXX_COMPILER_FLAG(${FLAG} ${SUPPORT_VAR})
    if (${SUPPORT_VAR})
        set(${FLAGS_VAR} "${${FLAGS_VAR}};${FLAG}" PARENT_SCOPE)
    endif ()
endfunction()

set(NON_PORTABLE_CXX_FLAGS)
mark_as_advanced(NON_PORTABLE_CXX_FLAGS)
CHECK_COMPILER_FLAG_SUPPORT("-march=native" COMPILER_SUPPORTS_MARCH_NATIVE NON_PORTABLE_CXX_FLAGS)
add_compile_options(${NON_PORTABLE_CXX_FLAGS})